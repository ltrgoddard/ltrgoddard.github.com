<html>
	<head>
 		<title>Computational Prynne</title>
		<script src="https://apis.google.com/js/client.js?"></script>
	</head>
	<body onload = "login();">
		<div id="input">
			<textarea id="source" rows="25" cols="75"></textarea>
			<button id="submit" onclick="search();">Search</button>
		</div>
		<div id="output">
		</div>
	</body>
	    		<script>

function login() {

	gapi.client.setApiKey("AIzaSyBWi6rHM4-tUAIuL3oXckjJN9V8yMXdtU8");
	gapi.client.load("books", "v1");
}

function search() {

	var chunkSize = 6;
	var counter = 0;
	var source = document.getElementById("source").value.replace(/(\r\n|\n|\r)/gm," ").replace(/ +/g," ").replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"").split(" ");
	console.log(source);
	var batch = gapi.client.newHttpBatch();

	while (counter + chunkSize <= source.length) {

		var chunk = source.slice(counter,counter+chunkSize);
		var searchTerm = "\"" + chunk.join(" ") + "\"";
		
		var request = gapi.client.request( {
			"path": "/books/v1/volumes",
			"params": {"q": searchTerm}
		});
		
		batch.add(request, {"id": "search" + counter});
		
		counter++;
	}
	
	batch.execute(function(response) {
		
		console.log(response);
		
		counter = 0;
		
		for (var i in response) {
			
			document.getElementById("output").innerHTML += "<b>" + source.slice(counter,counter+chunkSize); + "</b>" + "<br>";
			
			for (var key in response[i].result.items) {

				document.getElementById("output").innerHTML += "<a href=\"" + response[i].result.items[key].volumeInfo.infoLink + "\">" + response[i].result.items[key].volumeInfo.title + "</a>" + "<br><br>";
				//document.getElementById("output").innerHTML += "<a href=\"" + "test" + "\">" + "test" + "</a>" + "<br><br>";
			}
			
			counter++;
		}
	});
}
		</script>
</html>
