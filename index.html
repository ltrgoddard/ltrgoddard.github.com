<!DOCTYPE html> 
<html> 
	<head> 
		<title>Pearl in Modern English</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="pearl.css" />
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="jquery.touchSwipe.min.js"></script>
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49524936-1', 'pearlpoem.com');
  ga('send', 'pageview');

</script>
		<script>
		
		$(document).ready(function(){
			
			function post() {
				
				$('#numeral').html(group[caret]);
				$('#stanza1').html(group[caret+1]);
				$('#stanza2').html(group[caret+2]);
				$('#stanza3').html(group[caret+3]);
				$('#stanza4').html(group[caret+4]);
				$('#stanza5').html(group[caret+5]);
				
			}
			
			function postBox() {
				
				$('#stanza6').html(message);

			}
			
			function postXV6() {
				$('#stanza6').html('<div id="xv6">' + group[caret+6] + '</div>');
			}
			
			$.get('pearl.txt', function(raw) {
				
				stripped = raw.replace(/\n\n\n/g, '\n\n');
				data = stripped.replace(/\n/g, '<br />');
				group = data.split('<br /><br />');
				caret = 0;
				message = '<div id="message"></div>';
				$('#numeral').html(group[0]);
				$('#stanza1').html(group[1]);
				$('#stanza2').html(group[2]);
				$('#stanza3').html(group[3]);
				$('#stanza4').html(group[4]);
				$('#stanza5').html(group[5]);
				$('#stanza6').html(message);
				
				$(document).swipe( {
					
					swipeLeft:function(event, direction, distance, duration, fingerCount) {
						
						 	if (caret != 134 && caret != 98 && caret != 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
								post();
								postBox();
								$('#text').fadeIn(50);
							
				 			}, 50);
				 		}
				 		else if (caret == 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				post();
				 				postXV6();
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 98) {
				 			caret = caret+8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
								post();
								postBox();
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 134) {
				 				
				 			post();
				 			postBox();
				 			
				 		}
						 
  					},
  					
  					swipeRight:function(event, direction, distance, duration, fingerCount) {
  					
  					
  						if (caret != 0  && caret != 106) {
							caret = caret-7;
							$('#text').fadeOut(50);
							setTimeout(function() {
								
								post();
								postBox();
								$('#text').fadeIn(50);
							
							}, 50);
				 		}
				 		else if (caret == 106) {
				 			caret = caret-8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				post();
				 				postXV6();
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 0) {
				 			
				 			post();
							postBox();
							
				 		}
  						
  					}
				});
				
				
					
				$(document).keydown(function(e) {
    
					switch(e.which) {

				 		case 39: // right
				 		
				 		if (caret != 134 && caret != 98 && caret != 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
								$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
							
				 			}, 50);
				 		}
				 		else if (caret == 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html('<div id="xv6">' + group[caret+6] + '</div>');
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 98) {
				 			caret = caret+8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 134) {
				 				
				 			$('#numeral').html(group[caret]);
							$('#stanza1').html(group[caret+1]);
							$('#stanza2').html(group[caret+2]);
							$('#stanza3').html(group[caret+3]);
							$('#stanza4').html(group[caret+4]);
							$('#stanza5').html(group[caret+5]);
							$('#stanza6').html(message);
				 		}
						
						break;
						
						case 37: //left
						
						if (caret != 0  && caret != 106) {
							caret = caret-7;
							$('#text').fadeOut(50);
							setTimeout(function() {
								
								$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
							
							}, 50);
				 		}
				 		else if (caret == 106) {
				 			caret = caret-8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html('<div id="xv6">' + group[caret+6] + '</div>');
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 0) {
				 			
				 			$('#numeral').html(group[caret]);
							$('#stanza1').html(group[caret+1]);
							$('#stanza2').html(group[caret+2]);
							$('#stanza3').html(group[caret+3]);
							$('#stanza4').html(group[caret+4]);
							$('#stanza5').html(group[caret+5]);
							$('#stanza6').html(message);
							
				 		}
				 		
						default: return; // exit this handler for other keys
    					}
    					e.preventDefault(); // prevent the default action (scroll / move caret)
    				
				});
					
			});
			
		});
		
		</script>
	</head>
	<body>
			<div id="header">
				<h1>Pearl</h1>
				<h2>in Modern English</h2><hr />
				<p>Use your arrow keys (&larr; and &rarr;) or swipe to navigate this Modern English edition of the 14th century dream vision <em>Pearl</em>. <a href="pearl.txt">Click here</a> to download a plain text version.</p>
			</div>
			<div id="illustration"></div>
			<div id="content">
			<div id="text">
			<div id="numeral"></div>
			<div class="column" id="column1">
				<p class="stanza" id="stanza1"></p>
				<p class="stanza" id="stanza2"></p>
			</div>
			<div class="column" id="column2">
				<p class="stanza" id="stanza3"></p>
				<p class="stanza" id="stanza4"></p>
			</div>
			<div class="column" id="column3">
				<p class="stanza" id="stanza5"></p>
			</div>
			</div>
			<div class="column" id="column4">
				<p class="stanza" id="stanza6"></p>
			</div>
			</div>
			<div id="credits"><em>Translation by Kay Miller (<a href="mailto:k1immiller@gmail.com">k1immiller@gmail.com</a>), website by Louis Goddard (<a href="http://twitter.com/ltrgoddard">@ltrgoddard</a>)</em></div>
	</body>
</html>
