<!DOCTYPE html> 
<html> 
	<head> 
		<title>Pearl in Modern English</title>
		<link href='http://fonts.googleapis.com/css?family=EB+Garamond' rel='stylesheet' type='text/css' />
		<link rel="stylesheet" type="text/css" href="pearl.css" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script>
		
		$(document).ready(function(){
			
			$.get('pearl.txt', function(raw) {
				
				stripped = raw.replace(/\n\n\n/g, '\n\n');
				data = stripped.replace(/\n/g, '<br />');
				group = data.split('<br /><br />');
				caret = 0;
				message = '<div id="message"><em>This space is reserved for the mysterious sixth stanza in Section XV.</em></div>';
				$('#numeral').html(group[0]);
				$('#stanza1').html(group[1]);
				$('#stanza2').html(group[2]);
				$('#stanza3').html(group[3]);
				$('#stanza4').html(group[4]);
				$('#stanza5').html(group[5]);
				$('#stanza6').html(message);
					
				$(document).keydown(function(e) {
    
					switch(e.which) {

				 		case 39: // right
				 		
				 		if (caret != 134 && caret != 98 && caret != 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
								$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
							
				 			}, 50);
				 		}
				 		else if (caret == 91) {
				 			caret = caret+7;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(group[caret+6]);
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 98) {
				 			caret = caret+8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 134) {
				 				
				 			$('#numeral').html(group[caret]);
							$('#stanza1').html(group[caret+1]);
							$('#stanza2').html(group[caret+2]);
							$('#stanza3').html(group[caret+3]);
							$('#stanza4').html(group[caret+4]);
							$('#stanza5').html(group[caret+5]);
							$('#stanza6').html(message);
				 		}
						
						break;
						
						case 37: //left
						
						if (caret != 0  && caret != 106) {
							caret = caret-7;
							$('#text').fadeOut(50);
							setTimeout(function() {
								
								$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(message);
								$('#text').fadeIn(50);
							
							}, 50);
				 		}
				 		else if (caret == 106) {
				 			caret = caret-8;
				 			$('#text').fadeOut(50);
				 			setTimeout(function() {
				 				
				 				$('#numeral').html(group[caret]);
								$('#stanza1').html(group[caret+1]);
								$('#stanza2').html(group[caret+2]);
								$('#stanza3').html(group[caret+3]);
								$('#stanza4').html(group[caret+4]);
								$('#stanza5').html(group[caret+5]);
								$('#stanza6').html(group[caret+6]);
								$('#text').fadeIn(50);
								
				 			}, 50);
				 		}
				 		else if (caret == 0) {
				 			
				 			$('#numeral').html(group[caret]);
							$('#stanza1').html(group[caret+1]);
							$('#stanza2').html(group[caret+2]);
							$('#stanza3').html(group[caret+3]);
							$('#stanza4').html(group[caret+4]);
							$('#stanza5').html(group[caret+5]);
							$('#stanza6').html(message);
							
				 		}
				 		
						default: return; // exit this handler for other keys
    					}
    					e.preventDefault(); // prevent the default action (scroll / move caret)
    				
				});
					
			});
			
		});
		
		</script>
	</head>
	<body>
		<div id="header">
			<h1><em>Pearl</em> in<br />Modern<br />English</h1>
			<p>Use your arrow keys (&larr; <em>and</em> &rarr;) or swipe to navigate this Modern English edition of the 14th century dream vision <em>Pearl</em>. <a href="http://en.wikipedia.org/wiki/Pearl_(poem)">Click here</a> to learn more about the poem or to find a different version.</p>
		</div>
		<div id="illustration"></div>
		<div id="text">
		<h2 id="numeral"></h2>
		<div class="column" id="column1">
			<p class="stanza" id="stanza1"></p>
			<p class="stanza" id="stanza2"></p>
		</div>
		<div class="column" id="column2">
			<p class="stanza" id="stanza3"></p>
			<p class="stanza" id="stanza4"></p>
		</div>
		<div class="column" id="column3">
			<p class="stanza" id="stanza5"></p>
		</div>
		</div>
		<div class="column" id="column4">
			<p class="stanza" id="stanza6"></p>
		</div>
	</body>
</html>
